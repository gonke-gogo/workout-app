-- ç­‹ãƒˆãƒ¬è¨˜éŒ²ã‚¢ãƒ—ãƒªã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–ï¼ˆSQLãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°å¯¾å¿œç‰ˆï¼‰
CREATE DATABASE IF NOT EXISTS workoutdb;
USE workoutdb;

-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆã¨æ¨©é™ä»˜ä¸Ž
CREATE USER IF NOT EXISTS 'workoutuser'@'%' IDENTIFIED BY 'workoutpass';
GRANT ALL PRIVILEGES ON workoutdb.* TO 'workoutuser'@'%';
FLUSH PRIVILEGES;

-- ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE IF NOT EXISTS workouts (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    status TINYINT NOT NULL DEFAULT 0 COMMENT '0:äºˆå®š, 1:å®Ÿè¡Œä¸­, 2:å®Œäº†, 3:ã‚¹ã‚­ãƒƒãƒ—',
    difficulty TINYINT NOT NULL DEFAULT 1 COMMENT '1:åˆå¿ƒè€…, 2:ä¸­ç´šè€…, 3:ä¸Šç´šè€…, 4:é‡Žç£ç´š',
    muscle_group BIGINT NOT NULL DEFAULT 0 COMMENT '0:æœªæŒ‡å®š, 1:èƒ¸, 2:èƒŒä¸­, 3:è„š, 4:è‚©, 5:è…•, 6:è…¹ç­‹, 7:ä½“å¹¹, 8:è‡€éƒ¨, 9:æœ‰é…¸ç´ , 10:å…¨èº«',
    sets INT UNSIGNED DEFAULT 3,
    reps INT UNSIGNED DEFAULT 10,
    weight DECIMAL(6,2) DEFAULT 0.00,
    notes TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    completed_at TIMESTAMP NULL,
    
    -- ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§åˆ¶ç´„
    CHECK (status >= 0 AND status <= 3),
    CHECK (difficulty >= 1 AND difficulty <= 4),
    CHECK (sets > 0 AND sets <= 100),
    CHECK (reps > 0 AND reps <= 1000),
    CHECK (weight >= 0 AND weight <= 9999.99)
);

-- åŠ¹çŽ‡çš„ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æˆ¦ç•¥ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹æœ€é©åŒ–ç‰ˆï¼‰

-- 1. è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆæœ€ã‚‚é »ç¹ã«ä½¿ç”¨ã•ã‚Œã‚‹æ¤œç´¢æ¡ä»¶ï¼‰
CREATE INDEX idx_workouts_status_difficulty ON workouts(status, difficulty);
CREATE INDEX idx_workouts_muscle_difficulty ON workouts(muscle_group, difficulty);
CREATE INDEX idx_workouts_status_muscle ON workouts(status, muscle_group);

-- 2. ã‚«ãƒãƒªãƒ³ã‚°ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆSELECTå¥ã®æœ€é©åŒ–ï¼‰
CREATE INDEX idx_workouts_covering ON workouts(status, muscle_group, difficulty, name, created_at);

-- 3. å®Œäº†æ—¥æ™‚ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆNULLå€¤å«ã‚€ï¼‰
CREATE INDEX idx_workouts_completed ON workouts(completed_at);

-- 4. ç¯„å›²æ¤œç´¢ç”¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_workouts_created_range ON workouts(created_at, status);

-- 5. çµ±è¨ˆã‚¯ã‚¨ãƒªç”¨ã®è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_workouts_stats ON workouts(status, muscle_group, weight, created_at);

-- æ¥½ã—ã„ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆã‚ˆã‚Šå¤šæ§˜ãªãƒ‡ãƒ¼ã‚¿ã§ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°åŠ¹æžœã‚’ç¢ºèªï¼‰
INSERT INTO workouts (name, description, status, difficulty, muscle_group, sets, reps, weight, notes) VALUES
-- èƒ¸ã®ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆ (muscle_group = 1)
('ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹', 'èƒ¸ã‚’ãƒã‚­ãƒã‚­ã«é›ãˆã‚‹ï¼ãƒ¢ãƒ†ç”·ã¸ã®ç¬¬ä¸€æ­©', 0, 2, 1, 3, 10, 60.00, 'ä»Šæ—¥ã¯èª¿å­ãŒã„ã„ï¼ðŸ’ª'),
('ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹', 'ä¸Šéƒ¨èƒ¸ç­‹ã‚’é‡ç‚¹çš„ã«é›ãˆã‚‹', 0, 3, 1, 4, 8, 45.00, 'ä¸Šéƒ¨èƒ¸ç­‹ãŒåŠ¹ã„ã¦ã‚‹ï¼'),
('ãƒ‡ã‚¯ãƒ©ã‚¤ãƒ³ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹', 'ä¸‹éƒ¨èƒ¸ç­‹ã‚’é›ãˆã¦åŽšã¿ã‚’å‡ºã™', 0, 3, 1, 3, 12, 50.00, 'ä¸‹éƒ¨èƒ¸ç­‹ãŒãƒã‚­ãƒã‚­ï¼'),
('ãƒ€ãƒ³ãƒ™ãƒ«ãƒ•ãƒ©ã‚¤', 'èƒ¸ã®å†…å´ã‚’é›†ä¸­çš„ã«é›ãˆã‚‹', 0, 2, 1, 3, 15, 20.00, 'èƒ¸ã®å†…å´ãŒåŠ¹ã„ã¦ã‚‹ï¼'),

-- èƒŒä¸­ã®ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆ (muscle_group = 2)
('ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ', 'èƒŒä¸­ã‚’åºƒãã—ã¦é€†ä¸‰è§’å½¢ã«ï¼', 0, 3, 2, 3, 8, 80.00, 'é‡Žç£ç´šã®é‡é‡ã«æŒ‘æˆ¦ï¼ðŸ”¥'),
('ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³', 'åºƒã„èƒŒä¸­ã§é€†ä¸‰è§’å½¢ã‚’ç›®æŒ‡ã™', 0, 2, 2, 3, 12, 45.00, 'èƒŒä¸­ãŒåºƒãŒã£ã¦ããŸï¼'),
('ãƒ™ãƒ³ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ­ã‚¦', 'èƒŒä¸­ã®åŽšã¿ã‚’å¢—ã™', 0, 2, 2, 4, 10, 40.00, 'èƒŒä¸­ãŒåŽšããªã£ã¦ããŸï¼'),
('ã‚·ãƒ¼ãƒ†ãƒƒãƒ‰ãƒ­ã‚¦', 'èƒŒä¸­ã®ä¸­å¤®éƒ¨ã‚’é›ãˆã‚‹', 0, 1, 2, 3, 15, 30.00, 'èƒŒä¸­ã®ä¸­å¤®ãŒåŠ¹ã„ã¦ã‚‹ï¼'),

-- è„šã®ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆ (muscle_group = 3)
('ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ', 'ä¸‹åŠèº«ã‚’é›ãˆã¦ãƒ¢ãƒ†ç”·ã«ï¼', 0, 1, 3, 4, 15, 0.00, 'è‡ªé‡ã§ã‚‚ã‚­ãƒ„ã„...ðŸ˜…'),
('ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹', 'å¤ªã‚‚ã‚‚ã‚’å¤ªãã—ã¦é€žã—ã', 0, 2, 3, 4, 12, 100.00, 'è„šãŒå¤ªããªã£ã¦ããŸï¼'),
('ãƒ¬ãƒƒã‚°ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³', 'å¤ªã‚‚ã‚‚å‰éƒ¨ã‚’é›†ä¸­çš„ã«é›ãˆã‚‹', 0, 1, 3, 3, 20, 25.00, 'å¤ªã‚‚ã‚‚å‰éƒ¨ãŒåŠ¹ã„ã¦ã‚‹ï¼'),
('ãƒ¬ãƒƒã‚°ã‚«ãƒ¼ãƒ«', 'å¤ªã‚‚ã‚‚å¾Œéƒ¨ã‚’é›ãˆã‚‹', 0, 1, 3, 3, 15, 20.00, 'å¤ªã‚‚ã‚‚å¾Œéƒ¨ãŒåŠ¹ã„ã¦ã‚‹ï¼'),

-- è…•ã®ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆ (muscle_group = 5)
('è…•ç«‹ã¦ä¼ã›', 'è…•ã‚’å¤ªãã—ã¦å½¼å¥³ã«ã‚¢ãƒ”ãƒ¼ãƒ«', 0, 1, 5, 3, 20, 0.00, 'ç­‹è‚‰ç—›ã§æ­»ã«ãã†ðŸ’€'),
('ã‚«ãƒ¼ãƒ«', 'è…•ã‚’å¤ªãã—ã¦é€žã—ã', 0, 1, 5, 3, 15, 15.00, 'è…•ãŒå¤ªããªã£ã¦ããŸðŸ’ª'),
('ãƒˆãƒ©ã‚¤ã‚»ãƒƒãƒ—ã‚¹ãƒ—ãƒƒã‚·ãƒ¥ãƒ€ã‚¦ãƒ³', 'è…•ã®å¾Œã‚å´ã‚’é›ãˆã‚‹', 0, 2, 5, 3, 12, 35.00, 'è…•ã®å¾Œã‚å´ãŒåŠ¹ã„ã¦ã‚‹ï¼'),
('ãƒãƒ³ãƒžãƒ¼ã‚«ãƒ¼ãƒ«', 'è…•ã®å¤–å´ã‚’é›ãˆã‚‹', 0, 2, 5, 3, 12, 18.00, 'è…•ã®å¤–å´ãŒåŠ¹ã„ã¦ã‚‹ï¼'),

-- è…¹ç­‹ã®ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆ (muscle_group = 6)
('ãƒ—ãƒ©ãƒ³ã‚¯', 'è…¹ç­‹ã‚’å‰²ã£ã¦ãƒ“ãƒ¼ãƒãƒœãƒ‡ã‚£ã«ï¼', 0, 1, 6, 3, 60, 0.00, '1åˆ†é–“ãŒæ°¸é ã«æ„Ÿã˜ã‚‹â°'),
('ã‚¯ãƒ©ãƒ³ãƒ', 'è…¹ç­‹ã‚’å‰²ã£ã¦ãƒ¢ãƒ†ç”·ã«', 0, 1, 6, 3, 20, 0.00, 'è…¹ç­‹ãŒå°‘ã—è¦‹ãˆã¦ããŸðŸ˜Š'),
('ãƒ¬ãƒƒã‚°ãƒ¬ã‚¤ã‚º', 'ä¸‹è…¹éƒ¨ã‚’é›†ä¸­çš„ã«é›ãˆã‚‹', 0, 2, 6, 3, 15, 0.00, 'ä¸‹è…¹éƒ¨ãŒåŠ¹ã„ã¦ã‚‹ï¼'),
('ã‚µã‚¤ãƒ‰ãƒ—ãƒ©ãƒ³ã‚¯', 'è…¹æ–œç­‹ã‚’é›ãˆã‚‹', 0, 2, 6, 3, 45, 0.00, 'è…¹æ–œç­‹ãŒåŠ¹ã„ã¦ã‚‹ï¼'),

-- è‚©ã®ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆ (muscle_group = 4)
('ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹', 'è‚©ã‚’å¤§ããã—ã¦é€žã—ãè¦‹ã›ã‚‹', 0, 2, 4, 3, 10, 30.00, 'è‚©ãŒä¸¸ããªã£ã¦ããŸðŸ’ª'),
('ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º', 'è‚©ã®å¤–å´ã‚’é›ãˆã‚‹', 0, 1, 4, 3, 15, 8.00, 'è‚©ã®å¤–å´ãŒåŠ¹ã„ã¦ã‚‹ï¼'),
('ãƒªã‚¢ãƒ‡ãƒ«ãƒˆãƒ•ãƒ©ã‚¤', 'è‚©ã®å¾Œã‚å´ã‚’é›ãˆã‚‹', 0, 2, 4, 3, 12, 12.00, 'è‚©ã®å¾Œã‚å´ãŒåŠ¹ã„ã¦ã‚‹ï¼'),
('ãƒ•ãƒ­ãƒ³ãƒˆãƒ¬ã‚¤ã‚º', 'è‚©ã®å‰å´ã‚’é›ãˆã‚‹', 0, 1, 4, 3, 12, 10.00, 'è‚©ã®å‰å´ãŒåŠ¹ã„ã¦ã‚‹ï¼'),

-- å®Œäº†æ¸ˆã¿ã®ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆï¼ˆçµ±è¨ˆã‚¯ã‚¨ãƒªç”¨ï¼‰
('ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹å®Œäº†', 'èƒ¸ã‚’ãƒã‚­ãƒã‚­ã«é›ãˆãŸï¼', 2, 2, 1, 3, 10, 65.00, 'è¨˜éŒ²æ›´æ–°ï¼ðŸ’ª'),
('ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆå®Œäº†', 'ä¸‹åŠèº«ã‚’é›ãˆãŸï¼', 2, 1, 3, 4, 15, 0.00, 'ç­‹è‚‰ç—›ã§æ­©ã‘ãªã„ðŸ˜…'),
('ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆå®Œäº†', 'èƒŒä¸­ã‚’é›ãˆãŸï¼', 2, 3, 2, 3, 8, 85.00, 'é‡Žç£ç´šã®é‡é‡é”æˆï¼ðŸ”¥'),

-- ã‚¹ã‚­ãƒƒãƒ—ã—ãŸãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆ
('ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°', 'æœ‰é…¸ç´ é‹å‹•ã§è„‚è‚ªç‡ƒç„¼', 3, 1, 9, 1, 30, 0.00, 'é›¨ã§ã‚¹ã‚­ãƒƒãƒ—ðŸ˜¢'),
('ãƒ¨ã‚¬', 'æŸ”è»Ÿæ€§ã‚’é«˜ã‚ã‚‹', 3, 1, 7, 1, 60, 0.00, 'æ™‚é–“ãŒãªãã¦ã‚¹ã‚­ãƒƒãƒ—ðŸ˜…');

-- çµ±è¨ˆæƒ…å ±ã®è¡¨ç¤º
SELECT 
    'ç­‹ãƒˆãƒ¬è¨˜éŒ²ã‚¢ãƒ—ãƒªï¼ˆSQLãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ç‰ˆï¼‰' as app_name,
    COUNT(*) as total_workouts,
    COUNT(CASE WHEN status = 2 THEN 1 END) as completed_workouts,
    COUNT(CASE WHEN status = 3 THEN 1 END) as skipped_workouts,
    'æ¥½ã—ãç­‹ãƒˆãƒ¬ã—ã¾ã—ã‚‡ã†ï¼ðŸ’ª' as message
FROM workouts;

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ä½¿ç”¨çŠ¶æ³ã®ç¢ºèªç”¨ã‚¯ã‚¨ãƒªä¾‹
SELECT 'ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åˆ†æžç”¨ã‚¯ã‚¨ãƒªä¾‹:' as info;
SELECT '1. è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŠ¹æžœç¢ºèª:' as query_type;
SELECT '   EXPLAIN SELECT * FROM workouts WHERE status = 0 AND difficulty = 2;' as query;
SELECT '2. ã‚«ãƒãƒªãƒ³ã‚°ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŠ¹æžœç¢ºèª:' as query_type;
SELECT '   EXPLAIN SELECT status, muscle_group, difficulty, name FROM workouts WHERE status = 0;' as query;
SELECT '3. ç¯„å›²æ¤œç´¢åŠ¹æžœç¢ºèª:' as query_type;
SELECT '   EXPLAIN SELECT * FROM workouts WHERE created_at >= "2024-01-01" AND status = 0;' as query;
